<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafePath - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ù–∞–≤–∏–≥–∞—Ç–æ—Ä</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --safe-green: #2ecc71;
            --danger-red: #e74c3c;
            --warning-orange: #f39c12;
            --dark-blue: #2c3e50;
            --light-gray: #ecf0f1;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* –ü–æ–∏—Å–∫ –∏ –≤–≤–æ–¥ */
        .search-panel {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 90%;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .route-buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .btn-route {
            flex: 1;
            padding: 8px;
            font-size: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            background: var(--dark-blue);
        }

        /* –ö–∞—Ä—Ç–∞ */
        #map {
            flex-grow: 1;
            z-index: 1;
        }

        /* SOS –ö–Ω–æ–ø–∫–∞ */
        .sos-btn {
            position: fixed;
            right: 20px;
            bottom: 100px;
            width: 70px;
            height: 70px;
            background-color: var(--danger-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            z-index: 2000;
            cursor: pointer;
            border: 4px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav {
            height: 70px;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #ddd;
            z-index: 1000;
        }

        .nav-item {
            text-align: center;
            color: var(--dark-blue);
            cursor: pointer;
            font-size: 14px;
        }

        .nav-item i {
            display: block;
            font-size: 20px;
            margin-bottom: 2px;
        }

        .active-nav {
            color: var(--safe-green);
        }

        /* –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        #alert-box {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: none;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="alert-box">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –†—è–¥–æ–º –Ω–µ–æ—Å–≤–µ—â–µ–Ω–Ω—ã–π —É—á–∞—Å—Ç–æ–∫!</div>

    <div class="search-panel">
        <input type="text" placeholder="–û—Ç–∫—É–¥–∞ (–¢–æ—á–∫–∞ –ê)" id="start" value="–ú–æ–π –¥–æ–º">
        <input type="text" placeholder="–ö—É–¥–∞ (–¢–æ—á–∫–∞ –ë)" id="end">
        <div class="route-buttons">
            <button class="btn-route" onclick="drawRoute('safe')" style="background: var(--safe-green)">üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π</button>
            <button class="btn-route" onclick="drawRoute('fast')">‚ö° –ë—ã—Å—Ç—Ä—ã–π</button>
            <button class="btn-route" onclick="drawRoute('opt')">‚öñÔ∏è –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π</button>
        </div>
    </div>

    <div id="map"></div>

    <div class="sos-btn" onclick="triggerSOS()">
        SOS
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active-nav"><i class="fas fa-map-marked-alt"></i>–ö–∞—Ä—Ç–∞</div>
        <div class="nav-item"><i class="fas fa-shield-alt"></i>–ó–∞—â–∏—Ç–∞</div>
        <div class="nav-item" onclick="showProfile()"><i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å</div>
    </nav>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã (—Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
    const map = L.map('map').setView([55.751244, 37.618423], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬©Ô∏è OpenStreetMap'
    }).addTo(map);

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
    const dangerZones = [
        {coords: [55.755, 37.620], radius: 300, msg: "–¢–µ–º–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫"},
        {coords: [55.740, 37.600], radius: 400, msg: "–°—Ç—Ä–æ–π–∫–∞ / –ú–∞–ª–æ –ª—é–¥–µ–π"}
    ];

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ "–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω"
    dangerZones.forEach(zone => {
        L.circle(zone.coords, {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.3,
            radius: zone.radius
        }).addTo(map).bindPopup("–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞: " + zone.msg);
    });

    // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ª–∏–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç–æ–≤
    let currentRoute = null;

    function drawRoute(type) {
        if (currentRoute) map.removeLayer(currentRoute);

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ (—Å–∏–º—É–ª—è—Ü–∏—è —Ä–∞–∑–Ω—ã—Ö –ø—É—Ç–µ–π)
        let points;
        let color;
        let score;

        if (type === 'safe') {
            points = [
                [55.751, 37.618],
                [55.753, 37.630],
                [55.760, 37.640]
            ];
            color = '#2ecc71'; // –ó–µ–ª–µ–Ω—ã–π
            score = 95;
        } else if (type === 'fast') {
            points = [
                [55.751, 37.618],
                [55.755, 37.620], // –ü—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –æ–ø–∞—Å–Ω—É—é –∑–æ–Ω—É
                [55.760, 37.640]
            ];
            color = '#e74c3c'; // –ö—Ä–∞—Å–Ω—ã–π
            score = 40;
            showAlert();
        } else {
            points = [
                [55.751, 37.618],
                [55.758, 37.625],
                [55.760, 37.640]
            ];
            color = '#f39c12'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
            score = 70;
        }

        currentRoute = L.polyline(points, {color: color, weight: 6, opacity: 0.8}).addTo(map);
        map.fitBounds(currentRoute.getBounds());
        
        alert(`–ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω. –†–µ–π—Ç–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ${score}/100`);
    }

    // –§—É–Ω–∫—Ü–∏—è SOS
    function triggerSOS() {
        if (confirm("–û–¢–ü–†–ê–í–ò–¢–¨ –°–ò–ì–ù–ê–õ SOS? –í–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±—É–¥—É—Ç —Ä–∞–∑–æ—Å–ª–∞–Ω—ã –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–∞–º.")) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç Geolocation API –∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ –±—ç–∫–µ–Ω–¥
            navigator.geolocation.getCurrentPosition((pos) => {
                alert(`–°–ò–ì–ù–ê–õ –û–¢–ü–†–ê–í–õ–ï–ù!\n–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${pos.coords.latitude}, ${pos.coords.longitude}\n–†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω—ã.`);
            }, () => {
                alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏. –°–∏–≥–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–∞–Ω–Ω—ã–º.");
            });
        }
    }

    // –°–∏–º—É–ª—è—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    function showAlert() {
        const box = document.getElementById('alert-box');
        box.style.display = 'block';
        // –í–∏–±—Ä–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
        if ("vibrate" in navigator) navigator.vibrate([500, 200, 500]);
        
        setTimeout(() => { box.style.display = 'none'; }, 4000);
    }

    function showProfile() {
        alert("–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n–ò–º—è: –ê–Ω–Ω–∞\n–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã: –ú–∞–º–∞, –ë—Ä–∞—Ç\n–°—Ç–∞—Ç—É—Å: –í –ø—É—Ç–∏");
    }
</script>

</body>
</html>
